lttng-add-trigger(1)
====================
:revdate: 5 March 2021


NAME
----
lttng-add-trigger - Add LTTng triggers


SYNOPSIS
--------
[verse]
*lttng* ['linkgenoptions:(GENERAL OPTIONS)'] *add-trigger* [option:--id='ID'] [option:--user-id='UID']
      [option:--fire-every='N' | option:--fire-once-after='M']
      option:--condition='CTYPE' ['CARGS']
      option:--action='ATYPE' ['AARGS'] [option:--action='ATYPE' ['AARGS']]...

DESCRIPTION
-----------
The `lttng add-trigger` command creates and adds an LTTng _trigger_ to
the session daemon (see man:lttng-sessiond(8)).

A trigger is an association between a _condition_ and one or more
_actions_. When the condition of a trigger _T_ is satisfied, LTTng
executes the actions of _T_.

A tracing session doesn't need to be active (see man:lttng-start(1)) for
the condition of a trigger to be satisfied.

A trigger doesn't belong to a specific tracing session: it's global to
the session daemon. Within the session daemon, a trigger has a unique ID
(a string). By default, the `add-trigger` command automatically assigns
an ID to the added trigger. Use the option:--id option to assign a
specific ID instead.

With the `add-trigger` command, you add a trigger within the scope of
your Unix user. If your Unix user is `root`, you can add the trigger as
another user with the option:--user-id option.

By default, LTTng executes the actions of a trigger each time its
condition is satisfied. Use the option:--fire-every or
option:--fire-once-after option to override this default behaviour.

With the `add-trigger` command, you specify the condition of the trigger
to add with a <<cond-spec,condition specifier>> and its actions with one
or more <<action-spec,action specifiers>>.

Use the man:lttng-list-triggers(1) command to list the available
triggers for your Unix user (or for all users if your Unix user is
`root`).

Use the man:lttng-remove-trigger(1) command to remove an existing
trigger.

[[cond-spec]]
Condition specifier
~~~~~~~~~~~~~~~~~~~
Synopsis:

[verse]
option:--condition='CTYPE' ['CARGS']

A condition specifier is the option:--condition option, which specifies
the type of condition 'CTYPE', followed, depending on 'CTYPE', with zero
or more arguments 'CARGS'.

The available condition types are:

[[on-event-cond-spec]]Event rule match::
    Synopsis:
+
[verse]
option:--condition=`on-event` [nloption:--capture='CDESCR']... 'ERARGS'
+
An `on-event` condition is considered satisfied when an event occurs and
matches the event rule specified with 'ERARGS'.
+
'ERARGS' is what the man:lttng-enable-event(1) command expects, except
that you may :not: use a filter operand (see the command's
nloption:--filter option) which starts with `$ctx` or `$app`.
+
Capture event record and context fields with one or more
nloption:--capture options (see the <<capture-descr,Capture descriptor>>
section below to learn more). When an `on-event` condition with capture
descriptors is satisfied, the captured field values are available in the
evaluation object of the condition using the liblttng-ctl C{nbsp}API.
+
NOTE: Make sure to **single-quote** 'CDESCR' when running the command
from a shell, as capture descriptors can include characters having a
special meaning for most shells.


[[capture-descr]]
Capture descriptor
~~~~~~~~~~~~~~~~~~
A capture descriptor is a textual expression which describes how to read
an event record or context field.

The argument of a nloption:--capture option, when using an
<<on-event-cond-spec,event rule match condition specifier>>
(`on-event`), is a capture descriptor.

A capture descriptor expression is one of:

'NAME'::
    An event record field named 'NAME'.
+
The supported event record field types are:
+
--
* Integer
* Enumeration (integral value)
* Floating point number
* Static array of integers
* Dynamic array (``sequence'') of integers
* Text string
--
+
Examples: `my_field`, `target_cpu`, `ip`.

++$ctx.++__NAME__::
    A statically-known context field named 'NAME'.
+
List the available statically-known context field names with
man:lttng-add-context(1).
+
NOTE: You do :not: need to add a context field with the `lttng
add-context` command for it to be available to a capture descriptor
expression.
+
Examples: `$ctx.prio`, `$ctx.preemptible`,
`$ctx.perf:cpu:stalled-cycles-frontend`.

++$app.++__PROVIDER__++.++__NAME__::
    An application-specific context field named 'NAME' within the
    provider 'PROVIDER'.
+
See man:lttng-add-context(1) to learn more about application-specific
context fields.
+
--
NOTE: You do :not: need to add an application-specific context field
with the `lttng add-context` command for it to be available to a capture
descriptor expression.
--
+
Example: `$app.server:cur_user`.

__EXPR__++[++__INDEX__++]++::
    The element at index 'INDEX' of the array field (static or dynamic)
    identified by the expression 'EXPR'.
+
'INDEX' must be a constant, positive integral value.
+
Examples: `ip[3]`, `user_ids[15]`.

If, when an event occurs, a given capture descriptor doesn't identify
an existing event record or context field, then the captured value is
reported as being unavailable. This applies to:

* A nonexistent event record field name.
* A nonexistent statically-known context field name.
* A nonexistent application-specific context field name.
* An out-of-bounds array field index.


[[action-spec]]
Action specifier
~~~~~~~~~~~~~~~~
Synopsis:

[verse]
option:--action='ATYPE' ['AARGS']

An action specifier is the option:--action option, which specifies
the type of action 'ATYPE', followed, depending on 'ATYPE', with zero
or more arguments 'AARGS'.

The available action types are:

Notify::
    Synopsis:
+
[verse]
option:--action=`notify`
+
A `notify` action sends a notification through the notification
mechanism of the session daemon (see man:lttng-session(8)).
+
The session daemon sends details about the condition evaluation along
with the notification.
+
As of LTTng{nbsp}{lttng_version}, you can write a C/pass:[C++] program
to receive LTTng notifications (see the liblttng-ctl C{nbsp}headers).

Start a tracing session::
    Synopsis:
+
[verse]
option:--action=`start-session` 'SESSION'
+
A `start-session` action starts the tracing session named 'SESSION' like
man:lttng-start(1) would.
+
If no tracing session has the name 'SESSION' when the condition of the
trigger is satisfied, the `start-session` action does nothing.

Stop a tracing session::
    Synopsis:
+
[verse]
option:--action=`stop-session` 'SESSION'
+
A `stop-session` action stops the tracing session named 'SESSION' like
man:lttng-stop(1) would.
+
If no tracing session has the name 'SESSION' when the condition of the
trigger is satisfied, the `stop-session` action does nothing.

Rotate a tracing session::
    Synopsis:
+
[verse]
option:--action=`rotate-session` 'SESSION'
+
A `rotate-session` action rotates the tracing session named 'SESSION'
(archives its current trace chunk) like man:lttng-rotate(1) would.
+
If no tracing session has the name 'SESSION' when the condition of the
trigger is satisfied, the `rotate-session` action does nothing.

Take a tracing session snapshot::
    Synopsis:
+
[verse]
option:--action=`snapshot-session` 'SESSION'
+
A `snapshot-session` action takes a snapshot of the tracing session
named 'SESSION' like man:lttng-snapshot(1) would.
+
When the condition of the trigger is satisfied, the tracing session
named 'SESSION', if any, must be a snapshot-mode tracing session
(see man:lttng-create(1)).
+
If no tracing session has the name 'SESSION' when the condition of the
trigger is satisfied, the `rotate-session` action does nothing.

OPTIONS
-------
Identification
~~~~~~~~~~~~~~
option:--id='ID'::
    Set the unique ID of the trigger to add to 'ID' (a string) instead
    of the `add-trigger` command automatically assigning one.

option:--user-id='UID'::
    Add the trigger as the Unix user having the user ID 'UID'.
+
You may only use this option if your Unix user is `root`.


Firing policy
~~~~~~~~~~~~~
option:--fire-every='N'::
    Execute the actions of the trigger to add every 'N' times its
    condition is satisfied instead of each time.
+
You may not use this option with the option:--fire-once-after option.

option:--fire-once-after='M'::
    Execute the actions of the trigger to add _once_ after 'M' times
    its condition has been satisfied, then never afterwards.
+
You may not use this option with the option:--fire-every option.

Specifier
~~~~~~~~~
option:--condition='CTYPE'::
    Introductory option for a condition specifier of type 'CTYPE'.
+
See the <<cond-spec,Condition specifier>> section above to learn more.

option:--action='ATYPE'::
    Introductory option for an action specifier of type 'ATYPE'.
+
See the <<action-spec,Action specifier>> section above to learn more.


include::common-cmd-help-options.txt[]


include::common-cmd-footer.txt[]


SEE ALSO
--------
man:lttng-list-triggers(1),
man:lttng-remove-trigger(1),
man:lttng(1)
